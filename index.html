<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover" />
  <title>Chat Widget Peaking AI</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      --primary-color: #09334c;
      --primary-light: #0b4666;
      --primary-dark: #072738;
      --accent-color: #FF6B6B;
      --text-light: #ffffff;
      --text-dark: #333333;
      --bg-light: #ffffff;
      --bg-gray: #f5f7fa;
      --shadow-color: rgba(9, 51, 76, 0.15);
    }

    /* Animaci√≥n bot√≥n flotante */
    @keyframes pulseChat {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(9, 51, 76, 0.4); }
      70% { transform: scale(1.05); box-shadow: 0 0 0 25px rgba(9, 51, 76, 0); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(9, 51, 76, 0); }
    }

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ BOT√ìN FLOTANTE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .chat-button {
      position: fixed;
      bottom: 25px;
      right: 25px;
      width: 65px;
      height: 65px;
      border-radius: 50%;
      background-color: #e0e0e0;
      box-shadow: 0 5px 15px var(--shadow-color);
      cursor: pointer;
      z-index: 999;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      animation: pulseChat 2s infinite;
    }
    
    .chat-button:hover {
      background-color: #d0d0d0;
      transform: translateY(-3px);
    }
    
    .chat-button::before {
      content: '';
      position: absolute;
      width: 38px;
      height: 38px;
      background-image: url('https://peakingai.odoo.com/web/image/3420?unique=95dc08daf1c484632b85c894409676ad787bbf20');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ CONTENEDOR PRINCIPAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .chat-widget {
      display: none;
      flex-direction: column;
      position: fixed;
      bottom: 25px;
      right: 25px;
      width: 420px;
      height: 600px;
      max-width: calc(100% - 40px);
      max-height: calc(100% - 40px);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 10px 30px var(--shadow-color);
      background-color: var(--bg-light);
      z-index: 1000;
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .chat-header {
      background: linear-gradient(120deg, var(--primary-color), var(--primary-dark));
      display: flex;
      align-items: center;
      padding: 16px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      position: relative;
    }
    
    .chat-header-logo {
      display: flex;
      align-items: center;
    }
    
    .chat-header img { 
      height: 36px; 
      width: 36px;
      border-radius: 8px;
      margin-right: 12px; 
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    
    .chat-header .title {
      font-weight: 700;
      color: var(--text-light);
      font-size: 22px;
      letter-spacing: -0.5px;
    }
    
    .close-btn {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      color: var(--text-light);
      font-weight: 300;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 18px;
      transition: all 0.2s ease;
    }
    
    .close-btn:hover { 
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-50%) scale(1.1);
    }

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ HOME ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .chat-home {
      flex: 1;
      padding: 30px 20px;
      text-align: center;
      display: flex;
      flex-direction: column;
      justify-content: center;
      overflow-y: auto;
      background: var(--bg-light);
    }
    
    .chat-home h2 { 
      font-size: 24px; 
      margin-bottom: 16px; 
      font-weight: 700; 
      color: var(--primary-color);
      letter-spacing: -0.5px;
    }
    
    .chat-home p { 
      font-size: 15px; 
      color: #666; 
      margin-bottom: 25px;
      line-height: 1.5;
      max-width: 85%;
      margin-left: auto;
      margin-right: auto;
    }
    
    .home-button {
      padding: 14px 20px;
      background: var(--primary-color);
      border: none;
      color: var(--text-light);
      border-radius: 12px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(9, 51, 76, 0.15);
      margin: 8px 0;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .home-button:hover {
      background: var(--primary-light);
      transform: translateY(-2px) scale(1.01);
      box-shadow: 0 6px 16px rgba(9, 51, 76, 0.2);
    }
    
    .home-button:active {
      transform: translateY(1px);
      box-shadow: 0 2px 8px rgba(9, 51, 76, 0.1);
    }
    
    .home-button::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 150px;
      height: 150px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      transform: translate(-50%, -50%) scale(0);
      transition: transform 0.6s;
    }
    
    .home-button:hover::after {
      transform: translate(-50%, -50%) scale(1);
    }

    #btnActivalo {
      animation: pulsePricing 2.0s infinite;
      box-shadow: 0 0 0 0 rgba(249, 110, 8, 0.4);
    }

    @keyframes pulsePricing {
      0% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(249, 110, 8, 0.4);
      }
      70% {
        transform: scale(1.05);
        box-shadow: 0 0 0 10px rgba(249, 110, 8, 0);
      }
      100% {
        transform: scale(1);
        box-shadow: 0 0 0 0 rgba(249, 110, 8, 0);
      }
    }

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ CONVERSACIONES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .chat-conversations {
      position: relative;
      padding: 70px 16px 16px; /* Aumentado el padding superior para dar m√°s espacio */
      flex: 1;
      overflow-y: auto;
      display: none;
      flex-direction: column;
      background: var(--bg-light);
    }
    
    .chat-conversations h3 { 
      margin-top: 0; 
      color: var(--primary-color); 
      font-weight: 700; 
      font-size: 18px;
      margin-bottom: 16px;
      position: absolute;
      top: 16px;
      left: 0;
      width: 100%;
      text-align: center;
      padding-top: 30px; /* Espacio para el bot√≥n de volver */
    }
    
    .chat-conversations ul { 
      list-style: none; 
      padding: 0; 
      margin: 16px 0; 
    }
    
    .chat-conversations li {
      margin: 12px 0;
      padding: 16px;
      background: var(--bg-gray);
      border-radius: 12px;
      cursor: pointer;
      display: flex;
      align-items: center;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      transition: all 0.3s ease;
      border-left: 3px solid transparent;
    }
    
    .chat-conversations li:hover { 
      background: #eef2f7; 
      transform: translateY(-2px); 
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      border-left: 3px solid var(--primary-color);
    }
    
    .conversation-info { 
      display: flex; 
      flex-direction: column; 
      margin-right: auto; 
    }
    
    .conversation-lastmsg { 
      font-weight: 600; 
      margin-bottom: 6px; 
      color: var(--text-dark); 
      font-size: 14px;
    }
    
    .conversation-time { 
      font-size: 12px; 
      color: #888; 
    }
    
    .arrow-icon { 
      color: var(--primary-color); 
      margin-left: 12px; 
      font-size: 16px; 
      transition: transform 0.3s;
    }
    
    .chat-conversations li:hover .arrow-icon {
      transform: translateX(4px);
    }
    
    .conversations-back-btn {
      position: absolute;
      top: 15px; 
      left: 16px;
      background: var(--primary-color);
      color: var(--text-light);
      border: none; 
      border-radius: 10px;
      padding: 10px 16px; 
      cursor: pointer; 
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
    }
    
    .conversations-back-btn:hover { 
      background: var(--primary-light);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .conversations-back-btn::before {
      content: '‚Üê';
      margin-right: 6px;
      font-size: 14px;
    }

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ DEMO SELECTOR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .demo-selector {
      flex: 1;
      padding: 40px 24px;
      text-align: center;
      display: none;
      flex-direction: column;
      justify-content: center;
      overflow-y: auto;
      background: var(--bg-light);
    }
    
    .demo-selector h2 { 
      font-size: 24px; 
      margin-bottom: 20px; 
      font-weight: 700; 
      color: var(--primary-color);
      letter-spacing: -0.5px;
    }
    
    .demo-selector p { 
      font-size: 15px; 
      color: #666; 
      margin-bottom: 30px;
      line-height: 1.5;
    }
    
    .demo-option {
      padding: 16px 20px;
      background: var(--bg-gray);
      border: 2px solid var(--primary-color);
      color: var(--primary-color);
      border-radius: 12px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      box-shadow: 0 4px 12px rgba(0,0,0,0.08);
      margin: 12px 0;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .demo-option:hover {
      background: var(--primary-color);
      color: var(--text-light);
      transform: translateY(-3px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.12);
    }
    
    .demo-option:active {
      transform: translateY(1px);
    }
    
    .demo-option::before {
      content: '';
      position: absolute;
      width: 24px;
      height: 24px;
      left: 20px;
      opacity: 0.9;
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
    }
    
    .demo-option[onclick="startDemoWithTopic('Inmobiliarias')"]::before {
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2309334c"><path d="M10,20V14H14V20H19V12H22L12,3L2,12H5V20H10Z"/></svg>');
    }
    
    .demo-option[onclick="startDemoWithTopic('Notar√≠as')"]::before {
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2309334c"><path d="M14,17H7V15H14M17,13H7V11H17M17,9H7V7H17M19,3H5C3.89,3 3,3.89 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.89 20.1,3 19,3Z"/></svg>');
    }
    
    .demo-option[onclick="startDemoWithTopic('Retail')"]::before {
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2309334c"><path d="M17,18C15.89,18 15,18.89 15,20A2,2 0 0,0 17,22A2,2 0 0,0 19,20C19,18.89 18.1,18 17,18M1,2V4H3L6.6,11.59L5.24,14.04C5.09,14.32 5,14.65 5,15A2,2 0 0,0 7,17H19V15H7.42A0.25,0.25 0 0,1 7.17,14.75C7.17,14.7 7.18,14.66 7.2,14.63L8.1,13H15.55C16.3,13 16.96,12.58 17.3,11.97L20.88,5.5C20.95,5.34 21,5.17 21,5A1,1 0 0,0 20,4H5.21L4.27,2M7,18C5.89,18 5,18.89 5,20A2,2 0 0,0 7,22A2,2 0 0,0 9,20C9,18.89 8.1,18 7,18Z"/></svg>');
    }

    .demo-option[onclick="startDemoWithTopic('Fitness')"]::before {
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2309334c"><path d="M20.57,14.86L22,13.43L20.57,12L17,15.57L8.43,7L12,3.43L10.57,2L9.14,3.43L7.71,2L5.57,4.14L4.14,2.71L2.71,4.14L4.14,5.57L2,7.71L3.43,9.14L2,10.57L3.43,12L7,8.43L15.57,17L12,20.57L13.43,22L14.86,20.57L16.29,22L18.43,19.86L19.86,21.29L21.29,19.86L19.86,18.43L22,16.29L20.57,14.86Z"/></svg>');
  }

   .demo-option[onclick="startDemoWithTopic('Cl√≠nica')"]::before {
     background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2309334c"><path d="M19,8A1,1 0 0,1 20,9V19A1,1 0 0,1 19,20H5A1,1 0 0,1 4,19V9A1,1 0 0,1 5,8H19M10,12V15H8V12H10M10,9V11H8V9H10M14,12V15H12V12H14M14,9V11H12V9H14M18,12V15H16V12H18M18,9V11H16V9H18M4,6H11V2H13V6H20V7H4V6Z"/></svg>');
  }

   .demo-option[onclick="startDemoWithTopic('Restaurante')"]::before {
     background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2309334c"><path d="M11,9H9V2H7V9H5V2H3V9C3,11.12 4.66,12.84 6.75,12.97V22H9.25V12.97C11.34,12.84 13,11.12 13,9V2H11V9M16,6V14H18.5V22H21V2C18.24,2 16,4.24 16,6Z"/></svg>');
  }
    
    .demo-option:hover::before {
      filter: brightness(0) invert(1);
    }
    
    .demo-selector-back-btn {
      margin-top: 20px;
      background: var(--bg-gray);
      color: #666;
      border: none; 
      border-radius: 10px;
      padding: 12px 20px; 
      cursor: pointer; 
      font-size: 14px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .demo-selector-back-btn:hover { 
      background: #e5e9ef;
      transform: translateY(-2px);
    }
    
    .demo-selector-back-btn::before {
      content: '‚Üê';
      margin-right: 8px;
    }

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ CHAT BODY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .chat-body {
      padding: 65px 16px 16px; /* Aumentado el padding superior para el bot√≥n de volver */
      flex: 1;
      overflow-y: auto;
      display: none;
      flex-direction: column;
      position: relative;
      background: var(--bg-light);
      background-image: 
        radial-gradient(circle at 25% 15%, rgba(9, 51, 76, 0.02) 5%, transparent 15%),
        radial-gradient(circle at 75% 35%, rgba(9, 51, 76, 0.03) 5%, transparent 15%),
        radial-gradient(circle at 40% 65%, rgba(9, 51, 76, 0.01) 5%, transparent 15%),
        radial-gradient(circle at 85% 75%, rgba(9, 51, 76, 0.02) 5%, transparent 15%);
    }
    
    .chat-body-note { 
      font-size: 13px; 
      color: #888; 
      padding: 0 16px 8px; 
      display: none; 
      text-align: center;
      font-style: italic;
    }
    
    .chat-message { 
      margin: 10px 0; 
      max-width: 85%; 
      word-break: break-word; 
      padding: 12px 16px; 
      border-radius: 18px; 
      line-height: 1.4;
      font-size: 14px;
      animation: fadeIn 0.3s ease-out;
      box-shadow: 0 1px 5px rgba(0,0,0,0.05);
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .chat-message.user { 
      background: var(--primary-color); 
      color: var(--text-light); 
      align-self: flex-end;
      border-bottom-right-radius: 4px;
    }
    
    .chat-message.bot { 
      background: var(--bg-gray); 
      color: var(--text-dark); 
      align-self: flex-start; 
      position: relative;
      padding-left: 52px;
      border-bottom-left-radius: 4px;
    }
    
    .bot-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      position: absolute;
      left: 8px;
      top: 50%;
      transform: translateY(-50%);
      background-color: var(--primary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 16px;
      font-weight: bold;
      overflow: hidden;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .bot-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .chat-message.system { display: none; }

    .back-arrow-btn {
      position: absolute; 
      top: 15px; 
      left: 50%;
      transform: translateX(-50%);
      background: var(--primary-color); 
      color: var(--text-light); 
      border: none; 
      border-radius: 10px;
      padding: 10px 18px; 
      cursor: pointer; 
      font-size: 14px;
      font-weight: 500;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      z-index: 10;
      display: flex;
      align-items: center;
    }
    
    .back-arrow-btn:hover { 
      background: var(--primary-light);
      transform: translateX(-50%) translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    }
    
    .back-arrow-btn::before {
      content: '‚Üê';
      margin-right: 8px;
      font-size: 14px;
    }

    /* Botones de sugerencia de preguntas */
    .suggestion-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin: 15px 0;
      align-self: center;
      width: 90%;
      animation: fadeIn 0.5s ease-out;
    }
    
    .suggestion-button {
      background: rgba(9, 51, 76, 0.05);
      color: var(--primary-color);
      border: 1px solid rgba(9, 51, 76, 0.2);
      border-radius: 12px;
      padding: 12px 16px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s ease;
      text-align: left;
      position: relative;
      overflow: hidden;
    }
    
    .suggestion-button:hover {
      background: rgba(9, 51, 76, 0.1);
      transform: translateY(-2px);
      border-color: rgba(9, 51, 76, 0.3);
    }
    
    .suggestion-button::after {
      content: '‚Üí';
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      opacity: 0;
      transition: all 0.3s ease;
    }
    
    .suggestion-button:hover::after {
      opacity: 1;
      right: 12px;
    }

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ FOOTER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    .chat-footer {
      display: none;
      border-top: 1px solid #eee;
      padding: 12px 16px;
      background: var(--bg-light);
      box-shadow: 0 -2px 10px rgba(0,0,0,0.03);
    }
    
    .chat-input-container {
      display: flex;
      align-items: center;
      background: var(--bg-gray);
      border-radius: 24px;
      padding: 4px 8px 4px 16px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      transition: all 0.3s ease;
    }
    
    .chat-input-container:focus-within {
      box-shadow: 0 1px 5px rgba(9, 51, 76, 0.15);
      background: white;
    }
    
    .chat-footer input[type="text"] {
      flex: 1;
      padding: 10px 0;
      border: none;
      border-radius: 6px;
      background: transparent;
      font-size: 14px;
      color: var(--text-dark);
      font-family: 'Inter', sans-serif;
    }
    
    .chat-footer input[type="text"]:focus {
      outline: none;
    }
    
    .chat-footer-buttons {
      display: flex;
      gap: 6px;
      align-items: center;
    }
    
    .chat-footer button {
      background: var(--primary-color);
      border: none; 
      color: var(--text-light);
      padding: 8px 16px; 
      border-radius: 20px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      white-space: nowrap;
    }
    
    .chat-footer button:hover {
      background: var(--primary-light);
      transform: translateY(-1px);
    }
    
    .send-button::after {
      content: '‚Üí';
      margin-left: 5px;
      font-size: 16px;
      transition: transform 0.3s ease;
    }
    
    .send-button:hover::after {
      transform: translateX(3px);
    }

    /* Animaci√≥n para el bot√≥n de pricing */
    @keyframes pulsePricing {
      0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(249, 110, 8, 0.4); }
      70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(249, 110, 8, 0); }
      100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(249, 110, 8, 0); }
    }
    
    .pricing-button {
      background: #f96e08 !important;
      font-size: 13px !important;
      padding: 8px 14px !important;
      font-weight: 600 !important;
      animation: pulsePricing 2s infinite;
      margin-left: 12px;
    }
    
    .pricing-button:hover {
      background: #e55a00 !important;
      transform: translateY(-1px) scale(1.02);
      animation: none;
    }

    /* CSS ANIMATIONS FOR TYPING INDICATOR */
    .typing {
      min-height: 38px;
    }
    .typing-dot {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 3px;
      background: var(--primary-color);
      animation: typingAnimation 1.5s infinite ease-in-out;
    }
    .typing-dot:nth-child(1) { animation-delay: 0s; }
    .typing-dot:nth-child(2) { animation-delay: 0.2s; }
    .typing-dot:nth-child(3) { animation-delay: 0.4s; }
    
    @keyframes typingAnimation {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-6px); }
    }

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    @media (max-width: 768px) {
      .chat-widget {
        width: 100% !important;
        height: 100% !important;
        bottom: 0 !important; 
        right: 0 !important; 
        top: 0;
        border-radius: 0 !important; 
        box-shadow: none;
      }
      
      .chat-home,
      .demo-selector,
      .chat-conversations,
      .chat-body { 
        height: calc(100% - 60px); 
        overflow-y: auto; 
      }
      
      .chat-button {
        width: 60px;
        height: 60px;
      }
      
      .chat-footer-buttons {
        gap: 4px;
      }
      
      .pricing-button {
        font-size: 12px !important;
        padding: 6px 10px !important;
      }
    }

    /* Mayor comodidad en pantallas muy anchas */
    @media (min-width: 1200px) {
      .chat-widget { 
        width: 480px; 
        height: 650px; 
      }
    }
  </style>
</head>
<body>
  <!-- Bot√≥n flotante -->
  <div class="chat-button" id="chatButton"></div>

  <!-- Chat Widget -->
  <div class="chat-widget" id="chatWidget">
    <div class="chat-header">
      <div class="chat-header-logo">
        <img src="https://peakingai.odoo.com/web/image/2555?unique=324b08001569d6b97ba80e52813fc03cc53b069b" alt="Logo" />
        <span class="title">Peaking</span>
      </div>
      <span class="close-btn" id="closeChat">√ó</span>
    </div>

  <!-- HOME -->
    <div class="chat-home" id="chatHome">
      <h2>¬°Avancemos al futuro! üöÄ</h2>
      <p>¬øEn qu√© podemos ayudarte?</p>
      <button id="btnChatea" class="home-button" onclick="showMessenger()">Chatea con nosotros</button>
      <button id="btnContinuar" class="home-button" onclick="continueLastConversation()">Continuar √∫ltima conversaci√≥n</button>
      <button id="btnNueva" class="home-button" onclick="createNewConversation()">Nueva conversaci√≥n</button>
      <button id="btnEmpezarDemo" class="home-button" onclick="showDemoSelector()">Empezar Demo</button>
      <button class="home-button" onclick="showConversationsList()">Ver conversaciones anteriores</button>
      <button id="btnActivalo" class="home-button" style="background-color: #f96e08; border: none; margin-top: 10px;" onclick="window.open('https://www.peaking.ai/precios#planes', '_blank')"> Act√≠valo hoy </button>
    </div>

    <!-- SELECTOR DE DEMO -->
    <div class="demo-selector" id="demoSelector">
      <h2>¬øQu√© hace tu negocio?</h2>
      <p>Selecciona una opci√≥n para comenzar la demo personalizada:</p>
      <button class="demo-option" onclick="startDemoWithTopic('Inmobiliarias')">Inmobiliarias</button>
      <button class="demo-option" onclick="startDemoWithTopic('Notar√≠as')">Notar√≠as</button>
      <button class="demo-option" onclick="startDemoWithTopic('Retail')">Retail</button>
      <button class="demo-option" onclick="startDemoWithTopic('Fitness')">Fitness</button>
      <button class="demo-option" onclick="startDemoWithTopic('Cl√≠nica')">Cl√≠nica</button>
      <button class="demo-option" onclick="startDemoWithTopic('Restaurante')">Restaurante</button>
      <button class="demo-selector-back-btn" onclick="backToHome()">Volver</button>
    </div>

    <!-- HISTORIAL -->
    <div class="chat-conversations" id="chatConversations">
      <div class="conversations-header">
         <button class="" onclick="backToHome()" style="background: #02314e; color: #fff; border: none; border-radius: 6px; padding: 6px 16px; font-weight: 600; font-size: 0.92rem; cursor: pointer;">Volver</button>
        <h3>Historial de Conversaciones</h3>
      </div>
      <ul id="conversationsUl"></ul>
    </div>

    <!-- MENSAJES -->
    <div class="chat-body" id="chatBody">
      <button class="back-arrow-btn" onclick="backToHome()">Volver al inicio</button>
    </div>
    <div class="chat-body-note" id="chatNote">Inteligencia artificial a tu servicio ‚Ä¢ Peaking AI</div>

    <!-- FOOTER -->
    <div class="chat-footer" id="chatFooter">
      <div class="chat-input-container">
        <input type="text" id="chatInput" placeholder="Escribe tu mensaje..." onkeydown="if(event.key==='Enter'){ sendMessage(); }" />
        <div class="chat-footer-buttons">
          <button class="send-button" onclick="sendMessage()">Enviar</button>
          <button class="pricing-button" onclick="activateToday()">Act√≠valo hoy</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    const webhookUrl = {
      peakingAI: "https://peaking.app.n8n.cloud/webhook/a6ea7d8b-82b8-40f3-9538-dfd7b1430167/chat",
      demo: "https://peaking.app.n8n.cloud/webhook/efc735c0-7014-4671-86fd-ab052a2cdb91/chat"
    };
    
    // URL del avatar para los mensajes del bot
    const botAvatarUrl = "https://peakingai.odoo.com/web/image/2555?unique=324b08001569d6b97ba80e52813fc03cc53b069b";

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ INIT STORAGE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    if(!localStorage.getItem("currentSessionId")){localStorage.setItem("currentSessionId",crypto.randomUUID());}
    if(!localStorage.getItem("chatConversations")){localStorage.setItem("chatConversations",JSON.stringify({}));}
    if(!localStorage.getItem("sessionTypes")){localStorage.setItem("sessionTypes",JSON.stringify({}));}
    if(!localStorage.getItem("demoTopics")){localStorage.setItem("demoTopics",JSON.stringify({}));}

    document.addEventListener("DOMContentLoaded", () => {
      renderSession(localStorage.getItem("currentSessionId"));
      updateHomeButtons();
      
      // Agregar los event listeners directamente en JavaScript
      document.getElementById("chatButton").addEventListener("click", toggleChat);
      document.getElementById("closeChat").addEventListener("click", toggleChat);
    });

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ UI HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    function updateHomeButtons(){
      const btnChatea=document.getElementById("btnChatea");
      const btnContinuar=document.getElementById("btnContinuar");
      const btnNueva=document.getElementById("btnNueva");
      const convObj=JSON.parse(localStorage.getItem("chatConversations"))||{};
      const hasConversations=Object.keys(convObj).length>0;
      btnChatea.style.display=hasConversations?"none":"inline-block";
      btnContinuar.style.display=btnNueva.style.display=hasConversations?"inline-block":"none";
    }

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ TOGGLE CHAT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    function toggleChat(){
      const chat=document.getElementById("chatWidget");
      chat.style.display=(chat.style.display==="flex")?"none":"flex";
      backToHome();
    }

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ NUEVA FUNCI√ìN: ACT√çVALO HOY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    function activateToday() {
      // Primero enviar el mensaje al chat
      const inputField = document.getElementById("chatInput");
      inputField.value = "Activalo hoy";
      sendMessage();
      
      // Luego abrir la p√°gina de pricing en una nueva pesta√±a
      setTimeout(() => {
        window.open('https://www.peaking.ai/precios#planes', '_blank');
      }, 500);
    }

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ RENDER SESSION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    function renderSession(sessionId){
      const chatBody=document.getElementById("chatBody");
      chatBody.innerHTML='<button class="back-arrow-btn" onclick="backToHome()">Volver al inicio</button>';
      const convObj=JSON.parse(localStorage.getItem("chatConversations"))||{};
      const session=convObj[sessionId]||[];
      
      if(!session.length){
        const welcome=document.createElement("div");
        welcome.className="chat-message bot";
        
        // A√±adir avatar al mensaje del bot
        const avatar = document.createElement("div");
        avatar.className = "bot-avatar";
        const avatarImg = document.createElement("img");
        avatarImg.src = botAvatarUrl;
        avatarImg.alt = "Bot";
        avatar.appendChild(avatarImg);
        welcome.appendChild(avatar);
        
        // A√±adir el texto como nodo para evitar sobreescribir el avatar
        const textNode = document.createTextNode("¬øC√≥mo podemos ayudarte hoy? üß†");
        welcome.appendChild(textNode);
        
        chatBody.appendChild(welcome);
      } else {
        session.forEach(m=>{
          const div=document.createElement("div");
          div.className=`chat-message ${m.sender}`;
          
          // A√±adir avatar solo para mensajes del bot
          if(m.sender === "bot") {
            const avatar = document.createElement("div");
            avatar.className = "bot-avatar";
            const avatarImg = document.createElement("img");
            avatarImg.src = botAvatarUrl;
            avatarImg.alt = "Bot";
            avatar.appendChild(avatarImg);
            div.appendChild(avatar);
            
            // A√±adir texto como nodo para evitar sobreescribir el avatar
            const messageDiv = document.createElement("div");
            messageDiv.innerHTML = m.text;
            div.appendChild(messageDiv);
          } else {
            div.innerHTML = m.text;
          }
          
          chatBody.appendChild(div);
        });
      }
      chatBody.scrollTop=chatBody.scrollHeight;
    }

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ STORAGE HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    function storeMessage(sessionId, sender, text){
      const convObj=JSON.parse(localStorage.getItem("chatConversations"))||{};
      if(!convObj[sessionId]) convObj[sessionId]=[];
      convObj[sessionId].push({sender, text, time:Date.now()});
      localStorage.setItem("chatConversations", JSON.stringify(convObj));
    }

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ SEND MESSAGE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    async function sendMessage(){
      const input=document.getElementById("chatInput");
      const message=input.value.trim();
      if(!message) return;
      input.value="";
      
      // Eliminar botones de sugerencia si existen
      const suggestionsDiv = document.getElementById("suggestionButtons");
      if (suggestionsDiv) {
        suggestionsDiv.remove();
      }
      
      const sid=localStorage.getItem("currentSessionId");
      const chatBody=document.getElementById("chatBody");
      const userDiv=document.createElement("div");
      userDiv.className="chat-message user";
      userDiv.textContent=message;
      chatBody.appendChild(userDiv);
      storeMessage(sid,'user',message);
      chatBody.scrollTop=chatBody.scrollHeight;
      
      // Mostrar indicador de escritura
      const typingDiv = document.createElement("div");
      typingDiv.className = "chat-message bot typing";
      
      // A√±adir avatar al indicador de escritura
      const avatarTyping = document.createElement("div");
      avatarTyping.className = "bot-avatar";
      const avatarImgTyping = document.createElement("img");
      avatarImgTyping.src = botAvatarUrl;
      avatarImgTyping.alt = "Bot";
      avatarTyping.appendChild(avatarImgTyping);
      typingDiv.appendChild(avatarTyping);
      
      // A√±adir los puntos de escritura
      const typingIndicator = document.createElement("div");
      typingIndicator.innerHTML = '<span class="typing-dot">.</span><span class="typing-dot">.</span><span class="typing-dot">.</span>';
      typingDiv.appendChild(typingIndicator);
      
      chatBody.appendChild(typingDiv);
      chatBody.scrollTop = chatBody.scrollHeight;
      
      // Determinar qu√© webhook usar basado en el tipo de sesi√≥n
      const sessionTypes = JSON.parse(localStorage.getItem("sessionTypes"))||{};
      const demoTopics = JSON.parse(localStorage.getItem("demoTopics"))||{};
      const sessionType = sessionTypes[sid] || "normal";
      const demoTopic = demoTopics[sid] || "";
      
      const endpoint = sessionType === "demo" ? webhookUrl.demo : webhookUrl.peakingAI;
      
      try{
        // Preparar payload, incluyendo el tema de la demo si aplica
        const payload = {
          chatInput: message,
          key: sid
        };
        
        // Si es una demo, incluir el tema elegido
        if(sessionType === "demo" && demoTopic) {
          payload.demoType = demoTopic;
        }
        
        const res = await fetch(endpoint, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify(payload)
        });
        
        // Eliminar indicador de escritura
        const typingElement = document.querySelector(".typing");
        if (typingElement) {
          typingElement.remove();
        }
        
        const data = await res.json();
        let output = data.output || "Gracias, pronto nos pondremos en contacto.";
        output = output.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\((https?:\/\/[^\s)]+)\)/g,'<a href="$1" target="_blank">$1</a>');
        
        const botDiv = document.createElement("div");
        botDiv.className = "chat-message bot";
        
        // A√±adir avatar al mensaje del bot
        const avatar = document.createElement("div");
        avatar.className = "bot-avatar";
        const avatarImg = document.createElement("img");
        avatarImg.src = botAvatarUrl;
        avatarImg.alt = "Bot";
        avatar.appendChild(avatarImg);
        botDiv.appendChild(avatar);
        
        // A√±adir texto como nodo para evitar sobreescribir el avatar
        const messageDiv = document.createElement("div");
        messageDiv.innerHTML = output;
        botDiv.appendChild(messageDiv);
        
        chatBody.appendChild(botDiv);
        storeMessage(sid, 'bot', output);
      } catch(e) {
        console.error("Error:", e);
        
        // Eliminar indicador de escritura
        const typingElement = document.querySelector(".typing");
        if (typingElement) {
          typingElement.remove();
        }
        
        const err = document.createElement("div");
        err.className = "chat-message bot";
        
        // A√±adir avatar al mensaje de error
        const avatar = document.createElement("div");
        avatar.className = "bot-avatar";
        const avatarImg = document.createElement("img");
        avatarImg.src = botAvatarUrl;
        avatarImg.alt = "Bot";
        avatar.appendChild(avatarImg);
        err.appendChild(avatar);
        
        // A√±adir texto como nodo para evitar sobreescribir el avatar
        const errorMessage = document.createElement("div");
        errorMessage.textContent = "Oops! Algo sali√≥ mal. Por favor, intenta de nuevo.";
        err.appendChild(errorMessage);
        
        chatBody.appendChild(err);
        storeMessage(sid, 'bot', 'Oops! Algo sali√≥ mal. Por favor, intenta de nuevo.');
      }
      chatBody.scrollTop = chatBody.scrollHeight;
    }

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ DEMO HELPERS - COPIA EXACTA DE INMOBILIARIAS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    function showDemoSelector() {
      document.getElementById("chatHome").style.display = "none";
      document.getElementById("demoSelector").style.display = "flex";
      document.getElementById("chatConversations").style.display = "none";
      document.getElementById("chatBody").style.display = "none";
      document.getElementById("chatFooter").style.display = "none";
      document.getElementById("chatNote").style.display = "none";
    }
    
    function startDemoWithTopic(topic) {
      // Crear una nueva sesi√≥n para la demo
      const id = crypto.randomUUID();
      localStorage.setItem("currentSessionId", id);
      
      // Guardar que esta sesi√≥n es tipo demo y su tema
      const sessionTypes = JSON.parse(localStorage.getItem("sessionTypes")) || {};
      const demoTopics = JSON.parse(localStorage.getItem("demoTopics")) || {};
      
      sessionTypes[id] = "demo";
      demoTopics[id] = topic;
      
      localStorage.setItem("sessionTypes", JSON.stringify(sessionTypes));
      localStorage.setItem("demoTopics", JSON.stringify(demoTopics));
      
      // Guardar la selecci√≥n como primer mensaje
      storeMessage(id, 'system', `Demo iniciada: ${topic}`);
      pruneConversationsIfNeeded();
      
      // Mostrar el chat
      document.getElementById("demoSelector").style.display = "none";
      document.getElementById("chatBody").style.display = "flex";
      document.getElementById("chatFooter").style.display = "flex";
      document.getElementById("chatNote").style.display = "block";
      
      // Mostrar mensaje de bienvenida personalizado
      const chatBody = document.getElementById("chatBody");
      chatBody.innerHTML = '<button class="back-arrow-btn" onclick="backToHome()">Volver al inicio</button>';
      
      // Mostrar la selecci√≥n del usuario
      const userDiv = document.createElement("div");
      userDiv.className = "chat-message user";
      userDiv.textContent = topic;
      chatBody.appendChild(userDiv);
      
      // Enviar la solicitud al webhook y mostrar la respuesta
      sendInitialDemoMessage(topic);
    }
    
    async function sendInitialDemoMessage(topic) {
      const sid = localStorage.getItem("currentSessionId");
      const chatBody = document.getElementById("chatBody");
      
      // Mostrar indicador de escritura
      const typingDiv = document.createElement("div");
      typingDiv.className = "chat-message bot typing";
      
      // A√±adir avatar al indicador de escritura
      const avatarTyping = document.createElement("div");
      avatarTyping.className = "bot-avatar";
      const avatarImgTyping = document.createElement("img");
      avatarImgTyping.src = botAvatarUrl;
      avatarImgTyping.alt = "Bot";
      avatarTyping.appendChild(avatarImgTyping);
      typingDiv.appendChild(avatarTyping);
      
      // A√±adir los puntos de escritura
      const typingIndicator = document.createElement("div");
      typingIndicator.innerHTML = '<span class="typing-dot">.</span><span class="typing-dot">.</span><span class="typing-dot">.</span>';
      typingDiv.appendChild(typingIndicator);
      
      chatBody.appendChild(typingDiv);
      chatBody.scrollTop = chatBody.scrollHeight;
      
      try {
        const res = await fetch(webhookUrl.demo, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify({
            chatInput: topic,
            key: sid,
            demoType: topic
          })
        });
        
        // Eliminar indicador de escritura
        const typingElement = document.querySelector(".typing");
        if (typingElement) {
          typingElement.remove();
        }
        
        const data = await res.json();
        let output = data.output || `Has seleccionado ${topic}. ¬°Hazme una pregunta para que comencemos!`;
        output = output.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\((https?:\/\/[^\s)]+)\)/g,'<a href="$1" target="_blank">$1</a>');
        
        const botDiv = document.createElement("div");
        botDiv.className = "chat-message bot";
        
        // A√±adir avatar al mensaje del bot
        const avatar = document.createElement("div");
        avatar.className = "bot-avatar";
        const avatarImg = document.createElement("img");
        avatarImg.src = botAvatarUrl;
        avatarImg.alt = "Bot";
        avatar.appendChild(avatarImg);
        botDiv.appendChild(avatar);
        
        // A√±adir texto como nodo para evitar sobreescribir el avatar
        const messageDiv = document.createElement("div");
        messageDiv.innerHTML = output;
        botDiv.appendChild(messageDiv);
        
        chatBody.appendChild(botDiv);
        storeMessage(sid, 'bot', output);
        
        // EXACTAMENTE IGUAL QUE INMOBILIARIAS - Agregar botones para TODOS los sectores
        if (topic === 'Inmobiliarias') {
          addSuggestionButtons(chatBody, [
            "¬øQu√© Amenidades tiene Torre Vista Real?üèä",
            "¬øQu√© planes de financiamiento ofrecen?üíµ",
            "¬°Quiero agendar una cita!üè†"
          ]);
        }
        if (topic === 'Notar√≠as') {
          addSuggestionButtons(chatBody, [
            "¬øQu√© documentos necesito para una escritura?üìã",
            "¬øCu√°nto tiempo toma el proceso notarial?‚è∞",
            "¬øCu√°les son sus tarifas?üí∞"
          ]);
        }
        if (topic === 'Retail') {
          addSuggestionButtons(chatBody, [
            "¬øTienen ofertas especiales?üõçÔ∏è",
            "¬øCu√°l es su pol√≠tica de devoluciones?üîÑ",
            "¬øHacen entregas a domicilio?üöö"
          ]);
        }
        if (topic === 'Fitness') {
          addSuggestionButtons(chatBody, [
            "¬øQu√© planes de membres√≠a ofrecen?üí™",
            "¬øTienen clases grupales?üèÉ‚Äç‚ôÄÔ∏è",
            "¬øCu√°l es el horario del gimnasio?üïê"
          ]);
        }
        if (topic === 'Cl√≠nica') {
          addSuggestionButtons(chatBody, [
            "¬øQu√© especialidades m√©dicas tienen?üë©‚Äç‚öïÔ∏è",
            "¬øC√≥mo puedo agendar una cita?üìÖ",
            "¬øAceptan seguros m√©dicos?üè•"
          ]);
        }
        if (topic === 'Restaurante') {
          addSuggestionButtons(chatBody, [
            "¬øCu√°l es su men√∫ del d√≠a?üçΩÔ∏è",
            "¬øHacen reservaciones?üìû",
            "¬øTienen opciones veganas?ü•ó"
          ]);
        }
        
      } catch(e) {
        console.error("Error:", e);
        
        // Eliminar indicador de escritura
        const typingElement = document.querySelector(".typing");
        if (typingElement) {
          typingElement.remove();
        }
        
        const err = document.createElement("div");
        err.className = "chat-message bot";
        
        // A√±adir avatar al mensaje de error
        const avatar = document.createElement("div");
        avatar.className = "bot-avatar";
        const avatarImg = document.createElement("img");
        avatarImg.src = botAvatarUrl;
        avatarImg.alt = "Bot";
        avatar.appendChild(avatarImg);
        err.appendChild(avatar);
        
        // A√±adir texto como nodo para evitar sobreescribir el avatar
        const errorMessage = document.createElement("div");
        errorMessage.textContent = "Oops! Algo sali√≥ mal. Por favor, intenta de nuevo.";
        err.appendChild(errorMessage);
        
        chatBody.appendChild(err);
        storeMessage(sid, 'bot', 'Oops! Algo sali√≥ mal. Por favor, intenta de nuevo.');
      }
      
      chatBody.scrollTop = chatBody.scrollHeight;
    }
    
    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ SUGGESTION BUTTONS HELPERS - COPIA EXACTA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    function addSuggestionButtons(chatBody, suggestions) {
      // Crear contenedor para los botones de sugerencias
      const suggestionsDiv = document.createElement("div");
      suggestionsDiv.className = "suggestion-buttons";
      suggestionsDiv.id = "suggestionButtons";
      
      // Crear botones para cada sugerencia
      suggestions.forEach(suggestion => {
        const button = document.createElement("button");
        button.className = "suggestion-button";
        button.textContent = suggestion;
        button.onclick = () => {
          handleSuggestionClick(suggestion);
        };
        suggestionsDiv.appendChild(button);
      });
      
      // A√±adir botones al chat
      chatBody.appendChild(suggestionsDiv);
      chatBody.scrollTop = chatBody.scrollHeight;
    }
    
    function handleSuggestionClick(suggestion) {
      // Eliminar los botones de sugerencias
      const suggestionsDiv = document.getElementById("suggestionButtons");
      if (suggestionsDiv) {
        suggestionsDiv.remove();
      }
      
      // Rellenar el campo de entrada con la sugerencia seleccionada
      const inputField = document.getElementById("chatInput");
      inputField.value = suggestion;
      
      // Enviar el mensaje
      sendMessage();
    }

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ SESSION HELPERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    function getLastConversationId(){
      const convObj=JSON.parse(localStorage.getItem("chatConversations"))||{};
      let lastId=null,lastTime=-Infinity;
      Object.entries(convObj).forEach(([sid,msgs])=>{ if(msgs.length&&msgs[msgs.length-1].time>lastTime){lastTime=msgs[msgs.length-1].time;lastId=sid;} });
      return lastId;
    }

    function continueLastConversation(){
      const id=getLastConversationId();
      if(!id) return;
      localStorage.setItem("currentSessionId",id);
      showMessenger();
      renderSession(id);
    }

    function createNewConversation(){
      const id=crypto.randomUUID();
      localStorage.setItem("currentSessionId",id);
      
      // Guardar que esta sesi√≥n es tipo normal
      const sessionTypes = JSON.parse(localStorage.getItem("sessionTypes")) || {};
      sessionTypes[id] = "normal";
      localStorage.setItem("sessionTypes", JSON.stringify(sessionTypes));
      
      storeMessage(id,'system','Conversaci√≥n creada');
      pruneConversationsIfNeeded();
      showMessenger();
      
      // Mostrar mensaje de bienvenida personalizado
      const chatBody = document.getElementById("chatBody");
      chatBody.innerHTML = '<button class="back-arrow-btn" onclick="backToHome()">Volver al inicio</button>';
      
      // A√±adir mensaje de bienvenida con el avatar
      const welcome = document.createElement("div");
      welcome.className = "chat-message bot";
      
      // A√±adir avatar al mensaje del bot
      const avatar = document.createElement("div");
      avatar.className = "bot-avatar";
      const avatarImg = document.createElement("img");
      avatarImg.src = botAvatarUrl;
      avatarImg.alt = "Bot";
      avatar.appendChild(avatarImg);
      welcome.appendChild(avatar);
      
      // A√±adir el texto como nodo para evitar sobreescribir el avatar
      const textNode = document.createTextNode("¬°Hola! ¬øEn qu√© podemos ayudarte hoy? üòÅ");
      welcome.appendChild(textNode);
      
      chatBody.appendChild(welcome);
      storeMessage(id, 'bot', "¬°Hola! ¬øEn qu√© podemos ayudarte hoy? üòÅ");
      
      chatBody.scrollTop = chatBody.scrollHeight;
    }

    function pruneConversationsIfNeeded(){
      const convObj=JSON.parse(localStorage.getItem("chatConversations"))||{};
      const sessions=Object.keys(convObj);
      if(sessions.length<=5) return;
      sessions.sort((a,b)=>convObj[a][0].time-convObj[b][0].time);
      
      // Tambi√©n eliminar los tipos de sesi√≥n y temas demo asociados
      const sessionTypes = JSON.parse(localStorage.getItem("sessionTypes"))||{};
      const demoTopics = JSON.parse(localStorage.getItem("demoTopics"))||{};
      
      delete convObj[sessions[0]];
      delete sessionTypes[sessions[0]];
      delete demoTopics[sessions[0]];
      
      localStorage.setItem("chatConversations",JSON.stringify(convObj));
      localStorage.setItem("sessionTypes",JSON.stringify(sessionTypes));
      localStorage.setItem("demoTopics",JSON.stringify(demoTopics));
    }

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ NAVIGATION ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    function showMessenger(){
      document.getElementById("chatHome").style.display="none";
      document.getElementById("demoSelector").style.display="none";
      document.getElementById("chatConversations").style.display="none";
      document.getElementById("chatBody").style.display="flex";
      document.getElementById("chatFooter").style.display="flex";
      document.getElementById("chatNote").style.display="block";
    }

    function showConversationsList(){
      const convObj=JSON.parse(localStorage.getItem("chatConversations"))||{};
      const sessionTypes = JSON.parse(localStorage.getItem("sessionTypes"))||{};
      const demoTopics = JSON.parse(localStorage.getItem("demoTopics"))||{};
      const ul=document.getElementById("conversationsUl");
      ul.innerHTML="";
      const sessions=Object.keys(convObj);
      
      if(!sessions.length){
        const li=document.createElement("li");
        li.textContent="No hay conversaciones guardadas.";
        ul.appendChild(li);
      }else{
        // Ordenar sesiones de m√°s nueva a m√°s vieja
        const sortedSessions = [...sessions].sort((a, b) => {
          const aTime = convObj[a].length ? convObj[a][convObj[a].length - 1].time : 0;
          const bTime = convObj[b].length ? convObj[b][convObj[b].length - 1].time : 0;
          return bTime - aTime; // Orden descendente
        });
        
        sortedSessions.forEach(sid=>{
          const msgs=convObj[sid];
          let preview="Sin mensajes todav√≠a",time="";
          const sessionType = sessionTypes[sid] || "normal";
          const demoTopic = demoTopics[sid] || "";
          const type = sessionType === "demo" ? `Demo ${demoTopic}` : "Chat";
          
          if(msgs.length){
            const last=msgs[msgs.length-1];
            const tmp=document.createElement("div");tmp.innerHTML=last.text;preview=(tmp.textContent||"").slice(0,50)+(tmp.textContent.length>50?"...":"");
            time=getTimeAgo(last.time);
          }
          const li=document.createElement("li");
          li.innerHTML=`<div class="conversation-info"><span class="conversation-lastmsg">[${type}] ${preview}</span><span class="conversation-time">${time}</span></div><span class="arrow-icon">&gt;</span>`;
          li.onclick=()=>{localStorage.setItem("currentSessionId",sid);renderSession(sid);document.getElementById("chatConversations").style.display="none";document.getElementById("chatBody").style.display="flex";document.getElementById("chatFooter").style.display="flex";document.getElementById("chatNote").style.display="block";};
          ul.appendChild(li);
        });
      }
      document.getElementById("chatHome").style.display="none";
      document.getElementById("demoSelector").style.display="none";
      document.getElementById("chatBody").style.display="none";
      document.getElementById("chatFooter").style.display="none";
      document.getElementById("chatNote").style.display="none";
      document.getElementById("chatConversations").style.display="flex";
    }

    function backToHome(){
      document.getElementById("chatConversations").style.display="none";
      document.getElementById("demoSelector").style.display="none";
      document.getElementById("chatBody").style.display="none";
      document.getElementById("chatFooter").style.display="none";
      document.getElementById("chatNote").style.display="none";
      document.getElementById("chatHome").style.display="flex";
      updateHomeButtons();
    }

    /* ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ UTILS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
    function getTimeAgo(ts){
      const diff=Date.now()-ts; if(diff<0) return "";
      const s=Math.floor(diff/1000); if(s<60) return `hace ${s}s`;
      const m=Math.floor(s/60); if(m<60) return `hace ${m}min`;
      const h=Math.floor(m/60); if(h<24) return `hace ${h}h`;
      const d=Math.floor(h/24); if(d<30) return `hace ${d}d`;
      const mo=Math.floor(d/30); if(mo<12) return `hace ${mo}mes`;
      const y=Math.floor(mo/12);return `hace ${y}a√±os`; 
    }
  </script>
</body>
</html>


